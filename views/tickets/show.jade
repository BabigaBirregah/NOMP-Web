extends ../layout

block content
  - if (source_id)
    .row
      - ticketJsonUrl = '/' + source_type + '/' + source_id + '/json'
      h3 Source ticket
      label#source_ticket(for=ticketJsonUrl)
      form(action='/matching/confirm', method='post', role='form')
        input(type='hidden', name='_csrf', value="#{csrf_token}")
        input(type='hidden', name='ticket_type', value=ticket_type)
        input(type='hidden', name='id', value=ticket._id)
        input(type='hidden', name='source_type', value=source_type)
        input(type='hidden', name='source_id', value=source_id)
        button.btn.btn-success(type='submit') Match!

  .page-header
    h1= title
      small &nbsp;
        strong= ticket.classification_name
    small
      // TODO: make status indicated by icons
      span= 'Status: ' + ticket.statut
      |&nbsp;
      span= 'Posted at ' + ticket.creation_date
      span.pull-right
        a(href='/' + ticket_type + '/matching/' + ticket._id) Matching
      span.pull-right &nbsp;|&nbsp;
      span.pull-right
        a(href='/' + ticket_type + '/' + ticket._id + '/edit') Modify

  // basic infobox and matching results box
  .row
    .col-md-8
      each keys in [{'header': 'Basic', 'keys': [{'key': 'user', 'label': 'Author'}, {'key': 'source_actor_type_name', 'label': 'Source actor'}, {'key': 'target_actor_type_name', 'label': 'Target actor'}, {'key': 'address', 'label': 'Address'}]}, {'header': 'Availability', 'keys': [{'key': 'start_date', 'label': 'From'}, {'key': 'end_date', 'label': 'To'}, {'key': 'quantity', 'label': 'Quantity'}, {'key': 'cost', 'label': 'Cost'}, {'key': 'budget', 'label': 'Budget'}]}]
        .panel.panel-default
          .panel-heading
            strong= keys.header
          table.table.table-bordered.table-condensed
            each key in keys.keys
              - if (ticket[key.key] !== undefined)
                tr
                  td
                    strong= key.label
                  td= ticket[key.key]
      .panel.panel-default
        .panel-heading
          strong Descriptions
        .panel-body
          p.list-ticket-description= ticket.description
      .panel.panel-default
        .panel-heading
          label#matching_results_label(for='/' + ticket_type + '/matching/' + ticket._id)
            strong Matching results
        ul#matching_results_list.list-group
    
    .col-md-4
      // display photos
      - if (ticket.media !== undefined && ticket.media.image !== undefined && ticket.media.image.length > 0)
        #carousel-ticket-photos.carousel.slide(data-ride="carousel")
          ol.carousel-indicators
            each val, index in ticket.media.image
              li(data-target="#carousel-ticket-photos", data-slide-to=index, class=index==0?"active":"")
          .carousel-inner
            each val, index in ticket.media.image
              - var image_url = val.replace(/^\.\/public/, '')
              .item(class=index==0?"active":"")
                img(src="#{image_url}", alt=title, title=title)
          -if (ticket.media.image.length > 1)
            a.left.carousel-control(href="#carousel-ticket-photos", data-slide="prev")
              span.glyphicon.glyphicon-chevron-left
            a.right.carousel-control(href="#carousel-ticket-photos", data-slide="next")
              span.glyphicon.glyphicon-chevron-right
        
        // contact info
      .panel.panel-default(style="margin-top: 15px;")
        .panel-heading
          strong Contact
        table.table.table-bordered.table-condensed
          each key in [{'key': 'contact_name', 'label': 'Contact name'}, {'key': 'contact_email', 'label': 'Email'}, {'key': 'contact_phone', 'label': 'Phone no.'}, {'key': 'contact_mobile', 'label': 'Mobile no.'}]
            - if (ticket[key.key] !== undefined)
              tr
                td
                  strong= key.label
                td= ticket[key.key]